<center>
  <h1>
    计算机网络原理第五次作业
  </h1>
</center>

<center>
  甘乔尹 计92 2019011240
</center>

<center>
  <h2>
    书面作业部分
  </h2>
</center>

**5.2**   答：这不意味着虚电路不需要具备将单个数据包从任意源端路由到任意接收方的能力。因为在建立虚电路连接的时候，连接请求的包就需要从源端路由到接收方。

**5.3**   答：传输速率、窗口大小、最大数据包长度。

**5.9**   解：假设有 $a$ 个簇，每个簇有 $b$ 个区域，每个区域有 $k$ 个路由器，需要满足 $abk=4800$，在接近 $\sqrt[3]{{4800}}$ 也就是 16 的范围内进行寻找，使得 $a+b+k$ 最小，得到的组合为 $(15,16,20)$，顺序可更改。所以最佳组合的簇、簇中区域数、区域中路由器数应该为 $(15,16,20)$ 的六种全排列。

**5.10** 答：当路由器收到目的地址为移动主机的 ip 地址的包的时候，路由器发出 ARP 请求，请求对应的 MAC 地址。如果移动主机不在家乡网络，家乡代理用自己的 MAC 地址回答请求，这样路由器就认为家乡代理是目的地址，家乡代理完成截获工作。

**5.22** 答：不能保证。如果网络负载小，常规包延迟也较低，和加速型数据包延迟相近；如果加速型数据包过多也会造成阻塞，延时变长。

**5.28** 解：子网掩码长度 $mask=8+8+4=20$，所以可以容纳主机数量为 $2^{32-20}-2=4094$ 台。

**5.34** 答：在使用 NAT 模式之后在某个连接中所有的数据包都是通过一个相同的路由器转发的，如果在本题条件中所有其他路由器都向这个出口路由器转发，那么只要不是出口路由器停机，公司内部的路由器停机网络也可以使用。

**5.40** 解：$t=2^{16\times8}/10^6*10^{-12}=3.40\times10^{20}s$。

**5.42** 答：需要进行技术性改变，具体体现为对 IP 字段的长度进行拓展。

<center>
  <h2>
    IP、ICMP及ND观察实验部分
  </h2>
</center>

### IP 协议

* #### **观察普通 IP 分组**

  如下图所示，选取捕获到的一个分组进行分析，分组头部的 Version 字段的值为 6，正确。Payload Length 长度为 144，正确。Source 为 `https://mirrors6.tuna.tsinghua.edu.cn/` 的 IPv6 地址，Destination 为本机的临时 IPv6 地址，正确。

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211213191912104.png" alt="image-20211213191912104" style="zoom: 33%;" />

  如下图所示，选取 ping 应答分组进行分析，分组头部的 Version 字段的值为 6，正确。Payload Length 长度为 16，正确。Source 为 `www.tsinghua.edu.cn` 的 IPv6 地址，Destination 为本机的临时 IPv6 地址，正确。Hop Limit 值为 58，由于经过一个路由器值减一，所以一共经过了 64-58 = 6 个路由器。

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211213192705364.png" alt="image-20211213192705364" style="zoom: 33%;" />

* #### 观察**IP**分片与重组

  观察到的 ping 请求分组如下所示：

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211213202512423.png" alt="image-20211213202512423" style="zoom:33%;" />

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211213202549300.png" alt="image-20211213202549300" style="zoom:33%;" />

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211213202614806.png" alt="image-20211213202614806" style="zoom:33%;" />

  可见每次发出的 IP 分组带有拓展头，Identification 的字段一致为 `0x69d7910f`，MF 字段分别为1、1、0，1代表的是后面有更多数据片，0代表的是没有更多数据片，是最后一个包。Offset 分别为 0bytes、1232bytes、2464bytes，这保证了分片在乱序到达的时候也可以根据 Offset 重组出原来的分组。ping 应答分组的情况与 ping 请求分组类似，不同点在于包是乱序到达的，如前所述通过 Offset 可以重组出原来的分组。如下所示：

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211213203649737.png" alt="image-20211213203649737" style="zoom:33%;" />

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211213203718502.png" alt="image-20211213203718502" style="zoom:33%;" />

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211213203736808.png" alt="image-20211213203736808" style="zoom:33%;" />

* #### 思考题

  **1、观察 `traceroute` 程序发送的一系列分组中的 Hop Limit 字段，它们有何特点？**

  答：发送的分组中 HopLimit 字段由 1 开始递增 1，直到可达为止，这样就可以通过 TTL 减到 0 时中间路由器发回的消息判断经过的所有路由器。如下所示为发送的包 Hop Limit 由 2 变为 3：

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211214162515468.png" alt="image-20211214162515468" style="zoom: 25%;" />

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211214162539311.png" alt="image-20211214162539311" style="zoom:25%;" />

  **2、ICMP、TCP、UDP以及分片扩展头对应的 Next Header 值分别是多少？**

  答：58、6、17、44。

  **3、分片扩展头(若有)在一个IP分组的什么位置，即从第几个字节开始到第几个字节结束？不带有和带有分片扩展头时，上层协议的有效载荷(payload)分别从第几个字节开始？**

  答：54、61、54、62。

  **4、什么情况下IP分组需要分片？在哪里分片?又是在哪里重新组装起来的？**

  答：数据报封装成帧时，数据报的总长度必须小于最大数据长度，当分组长度过长的时候就需要进行分片。在发送方网络层接口处分片，在接收方网络层接口处重组。

  **5、阅读RFC8200: Internet Protocol, Version 6 (IPv6) Specification，了解IPv6定义的扩展头(Extension Header)除了分片扩展头还有哪些，Next Header值以及功能分别如何，列举两个。**

  答：封装安全载荷（ESP），Next Header 值为 50，提供保密性服务，也可以同时提供消息认证；认证头（AH），Next Header 值为 51，提供消息认证服务。

### ICMP协议

* #### 观察 ICMP 回显请求及回显应答

  回显请求和回显应答如下所示，各个字段均和标准一致，同时请求与应答的标识符（`0x9539`）、序列号（`0`）以及数据（`61 b7 5c b1 00 08 9d db  `）都完全一致。 

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211213224958745.png" alt="image-20211213224958745" style="zoom:33%;" />

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211213225030581.png" alt="image-20211213225030581" style="zoom:33%;" />

* #### 观察 ICMP 目标不可达消息

  如下所示，Type、Code 以及 Checksum 字段均和标准一致。Unused 字段为 4 字节的 0 正确，后面的内容为发送的数据包，正确。

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211213225611561.png" alt="image-20211213225611561" style="zoom:33%;" />

* #### **观察 ICMP 超时消息**

  命令行中的信息如下所示：

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211215205040549.png" alt="image-20211215205040549" style="zoom:33%;" />

  在传输的过程中由于 TTL 逐跳减一，到 0 的时候到达的路由器就不再转发这个数据包，而回复 ICMP 超时消息，所以这次 ping 操作不能成功获得对方主机的应答。

  捕捉的分组如下所示，ICMP 的各个字段和标准均一致：

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211213232137760.png" alt="image-20211213232137760" style="zoom:33%;" />

* #### 思考题

  **1、前文观察的ICMP目标不可达消息的Code字段值为多少，代表什么含义?**

  答：Code 字段值为 4，代表端口不可达（Port Unreachable）。

  **2、前文观察的ICMP目标不可达消息以及超时消息的Unused字段之后的数据是什么内容?**

  答：原本请求的 IP 包的复制内容。

  **3、前文观察的ICMP目标不可达消息以及超时消息分别由谁发送?**

  答：ICMP目标不可达消息由目标发送；超时消息由 TTL 减为 0 的那个路由器发送。

  **4、为什么有些类型的ICMP消息(例如目标不可达消息)中有一个Unused字段，而另一些(例如回显消息)则没有？注意它们的⻓度，分析这样设计可能是出于什么考虑。**

  答：因为回显消息中需要含有 Identifier 和  Identifier 和 Sequence 字段。 字段，而这些字段在目标不可达这样的 ICMP 消息中无意义，为了保持头部长度相同置为 Unused 字段。

### ND 协议

* #### 观察地址解析(**Address Resolution**)过程及**ND**报文格式

  删除实验者主机上的所有邻居缓存表项之后，触发地址解析过程，捕获到的 Neighbor Solicitation以及Neighbor Advertisement 报文如下所示：

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211214153853696.png" alt="image-20211214153853696" style="zoom:33%;" />

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211214153815606.png" alt="image-20211214153815606" style="zoom:33%;" />

  可见除了校验和，IP 分组头部、报文格式、内容和携带的选项源地址和目的地址外均相同，Neighbor Solicitation 报文源地址是实验主机，目的地址是组播地址；Neighbor Advertisement 报文源地址是目的路由器，目的地址是实验主机。

  一段时间后再次触发地址解析过程，捕获到的 Neighbor Solicitation以及Neighbor Advertisement 报文如下所示：

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211214154556754.png" alt="image-20211214154556754" style="zoom:33%;" />

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211214154356406.png" alt="image-20211214154356406" style="zoom:33%;" />

  

  这一次的 Neighbor Advertisement 的IP分组头部、报文格式、内容以及携带的选项与上文的相比没有变化，Neighbor Solicitation 的目的地址变成了单播地址，除校验和外其他与上文相比没有变化。

* #### 观察**Router Advertisement**以及**DAD**

  接口初始化过程中第一个 Router Advertisement 报文如下所示：

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211214155818911.png" alt="image-20211214155818911" style="zoom:33%;" />

  可以看出实验主机获得的 IP 地址（`2402:f000:2:f001:5599:6269:5988:60fe`）是该前缀内的。

  捕获到的用于进行 DAD 的组播 Neighbor Solicitation 如下所示：

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211214160248103.png" alt="image-20211214160248103" style="zoom:33%;" />

  <img src="/Users/ganqiaoyin/Library/Application Support/typora-user-images/image-20211214160309559.png" alt="image-20211214160309559" style="zoom:33%;" />

  可见报文的目标地址为实验主机固定 ip 地址和临时 ip 地址，而且不带有源或目标链路层地址选项，因为 DAD 的主要目的是进行地址重复性检测，以确认在链路上该地址的唯一性，与链路层地址的获取无关。

* #### 思考题

  **1、查阅相关文献，在实验者所使用的系统中，哪一个选项控制邻居缓存表项状态由REACHABLE变为STALE的超时时间(ReachableTime)?**

  答：MacOS 中，Expire 选项控制邻居缓存表项状态的超时时间。

  **2、前文观察的源地址不为未指定地址的组播Neighbor Solicitation会带有源链路层地址(Source Link-Layer Address)选项，对应的Neighbor Advertisement也会带有目标链路层地址(Target Link-Layer Address)选项。然而，前文观察的单播Neighbor Solicitation及其对应的Neighbor Advertisement有时可能不带这样的选项(与实验环境有关)，这是为什么?**

  答：可能的原因是在组播之后对方已经存储了主机的链路层地址，所以在单播的时候无需发送主机的链路层地址选项。

  **3、Router Advertisement报文中的M(Managed address configuration)标志以及O(Other configuration)标志分别是什么含义?**

  答： M 标志代表着如何进行地址配置。0：客户端通过无状态协议获得IPv6地址；1：客户端通过有状态协议获得IPv6地址。
  O 标志代表着如何进行除了地址之外的其他配置。0：标识客户端通过无状态协议获得其他配置信息，1：标识客户端通过有状态协议获得其他配置信息。

  **4、前文观察的源地址为未指定地址的组播Neighbor Solicitation是否有对应的Neighbor Advertisement?这说明了什么问题?**

  答：没有，这说明了主机地址在链路上具有唯一性，地址配置生效。